<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Provisional Document Request â€“ HNBU Medical Education University</title>
  <meta name="description" content="Request your provisional document. Verification may take up to 48 hours."/>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    :root{
      --brand:#0b5cab; --brand-dark:#084c8e; --bg-overlay:rgba(0,0,0,0.45);
      --card-bg:#ffffff; --success-bg:#d4edda; --success-fg:#155724;
      --error-bg:#f8d7da; --error-fg:#721c24;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:"Segoe UI",Roboto,Arial,sans-serif;color:#222;background:var(--brand);}
    .bg{position:fixed;inset:0;background:url("https://i.postimg.cc/m2x9tZx5/Hemwati-Nandan-Bahuguna-Uttarakhand-Medical-Education-University-1.png") center/cover no-repeat;}
    .overlay{position:fixed;inset:0;background:var(--bg-overlay);}
    .page{position:relative;min-height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:24px;text-align:center;}
    .header{color:#fff;margin-bottom:20px;}
    .brand-row{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;}
    .logo{width:80px;height:80px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden;border:3px solid rgba(255,255,255,0.6);}
    .logo img{width:100%;height:100%;object-fit:cover;}
    .college{font-weight:800;letter-spacing:.5px;line-height:1.3;text-transform:uppercase;font-size:clamp(16px,2vw + 12px,24px);max-width:90%;}
    .college .line2{display:block;font-weight:700;opacity:.95;}
    .card{width:100%;max-width:520px;background:var(--card-bg);border-radius:16px;box-shadow:0 18px 40px rgba(0,0,0,.35);padding:22px;}
    .title{margin:0 0 6px;text-align:center;color:#222;font-size:22px;font-weight:700;}
    .subtitle{margin:0 0 16px;text-align:center;color:#555;font-size:14px;}
    form{display:grid;gap:12px;margin-top:4px;}
    input,select,button{width:100%;padding:12px;border:1px solid #dcdcdc;border-radius:10px;font-size:15px;transition:.2s;background:#fff;}
    input:focus,select:focus{outline:none;border-color:var(--brand);box-shadow:0 0 0 4px rgba(11,92,171,.12);}
    .readonly{background:#f8f9fb;color:#333;border-style:dashed;}
    button{background:var(--brand);color:#fff;font-weight:700;border:none;cursor:pointer;transition:background .3s,transform .2s;}
    button:hover{background:var(--brand-dark);transform:scale(1.05);}
    button:disabled{opacity:.6;cursor:not-allowed;}
    .status{display:none;margin-top:10px;padding:10px;border-radius:10px;text-align:center;font-weight:600;}
    .status.success{display:block;background:var(--success-bg);color:var(--success-fg);}
    .status.error{display:block;background:var(--error-bg);color:var(--error-fg);}
    .footer{text-align:center;color:#ddd;font-size:12px;margin-top:20px;}
    #popup{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;}
    #popupContent{background:#fff;padding:20px 30px;border-radius:14px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.3);}
  </style>
</head>
<body>
  <div class="bg"></div><div class="overlay"></div>
  <div class="page">
    <div class="header">
      <div class="brand-row">
        <div class="logo"><img src="https://i.postimg.cc/Mp5z25mS/Untitled-design-1.png" alt="University Logo"/></div>
        <div class="college">HEMWATI NANDAN BAHUGUNA UTTARAKHAND<span class="line2">MEDICAL EDUCATION UNIVERSITY</span></div>
      </div>
    </div>

    <div class="card">
      <h1 class="title">Provisional Document Request</h1>
      <p class="subtitle">Fill in your details and complete the payment to submit your request.</p>

      <form id="requestForm" novalidate>
        <input type="text" name="roll_no" placeholder="Roll Number" required>
        <input type="text" name="name" placeholder="Full Name" required>
        <input type="text" name="father_name" placeholder="Father's Name" required>
        <input type="text" name="college_name" placeholder="College Name" required>
        <input type="text" name="course" placeholder="Course (e.g. MBBS, Nursing)" required>
        <input type="number" name="passing_year" placeholder="Passing Year" required min="1900" max="2100">
        <input type="email" name="email" placeholder="Email (for delivery link)" required>
        <input class="readonly" value="Provisional Document" readonly>
        <input type="hidden" name="document_type" value="Provisional">
        <button type="button" id="payBtn">Proceed to Payment</button>
        <div id="status" class="status"></div>
      </form>
    </div>

    <div class="footer">Â© <script>document.write(new Date().getFullYear())</script> HNBU Medical Education University</div>
  </div>

  <!-- Popup for success message -->
  <div id="popup">
    <div id="popupContent">
      <h2>âœ… Payment Successful</h2>
      <p>Your request has been accepted.<br>You will receive your document link once verified.</p>
      <button onclick="closePopup()">OK</button>
    </div>
  </div>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwpNCp9hVPxDmt-E9_B_dcd29TrKVV54dmyH_25lnsC-ZneBZEFRr7F-yjsrq-Kkrrc_Q/exec";
    const RAZORPAY_KEY = "rzp_test_RavafcyAvnSfBC"; // ðŸ”‘ Replace with your Razorpay Test Key ID
    const payBtn = document.getElementById("payBtn");
    const form = document.getElementById("requestForm");
    const statusBox = document.getElementById("status");
    const popup = document.getElementById("popup");

    function showStatus(msg, ok = true) {
      statusBox.textContent = msg;
      statusBox.className = "status " + (ok ? "success" : "error");
      statusBox.style.display = "block";
    }

    function openPopup() {
      popup.style.display = "flex";
    }
    function closePopup() {
      popup.style.display = "none";
    }

    payBtn.addEventListener("click", async () => {
      const data = Object.fromEntries(new FormData(form));
      if (!data.roll_no || !data.name || !data.email) {
        showStatus("Please fill all required fields before payment.", false);
        return;
      }

      const options = {
        key: RAZORPAY_KEY,
        amount: 100 * 100, // â‚¹100 in paise
        currency: "INR",
        name: "HNBU Medical Education University",
        description: "Provisional Document Request Fee",
        image: "https://i.postimg.cc/Mp5z25mS/Untitled-design-1.png",
        handler: async function (response) {
          // Payment successful â€” send data to Google Apps Script
          await submitRequest(data, response.razorpay_payment_id);
          openPopup();
          form.reset();
        },
        prefill: {
          name: data.name,
          email: data.email
        },
        theme: { color: "#0b5cab" }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    });

    async function submitRequest(data, paymentId) {
      data.payment_id = paymentId;
      const formData = new FormData();
      for (const key in data) formData.append(key, data[key]);

      try {
        const res = await fetch(WEB_APP_URL, { method: "POST", body: formData });
        const text = await res.text();
        let result;
        try { result = JSON.parse(text); } catch { result = { success: res.ok }; }
        if (!result.success) showStatus("Error saving your request.", false);
      } catch (err) {
        showStatus("Network error. Please try again later.", false);
      }
    }
  </script>
</body>
</html>
